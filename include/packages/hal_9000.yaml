hal_9000:

  var:
    morning:
    greetings:
    reminder:
    trash:
    recycle:

  automation:
    - alias: "Godmorgen"
      trigger:
        - platform: time
          at: "09:00:00"
      action:
        - service: homeassistant.update_entity
          data:
            entity_id: sensor.tid_naturlig
      
        - service: script.store_volume
          data_template:
            entity_id: media_player.kokken
            volume: 0.4

        - service: media_player.play_media
          entity_id: media_player.kokken
          data:
            media_content_id: 'http://soundbible.com/grab.php?id=1510&type=mp3'
            media_content_type: music

        - service: tts.google_translate_say
          entity_id: media_player.kokken
          data_template:
            message: >-
              Godmorgen.
              Det er i dag {{ states('sensor.dato') }}.
              Klokken er {{ states('sensor.tid_naturlig') }} og der er lige nu {{ state_attr('weather.brobyvaerk', 'temperature') }} grader i {{ state_attr('weather.brobyvaerk', 'friendly_name') }}.
              UV-indexet nÃ¥r i dag {{ states('sensor.max_uv_index') | round(2) }} og er hÃ¸jest klokken {{ as_timestamp(state_attr('sensor.max_uv_index', 'time')) | timestamp_custom("%H:%M") }} og der anbefales solcreme mellem {{ state_attr('sensor.uv_sun', 'protection_start_time') }} og {{ state_attr('sensor.uv_sun', 'protection_end_time') }}.

        - service: script.store_volume
          data_template:
            entity_id: media_player.kokken

    - alias: "Meddel om Affald/Genbrug"
      trigger:
        - platform: time
          at: "17:00:00"
      condition:
        condition: or
        conditions:
          - condition: template
            value_template: >-
              {{ is_state_attr('sensor.affald_hentes', 'days', '1') }}
          - condition: template
            value_template: >-
              {{ is_state_attr('sensor.genbrug_hentes', 'days', '1') }}
      action:
        - service: tts.google_translate_say
          entity_id: media_player.kokken
          data_template:
            message: >-
              {% set len = states('var.greetings').split("|") | length %}
              {% set ran_idx = range(0, len) | random() %}
              {{ states('var.greetings').split("|")[ran_idx] }}
              
              {% set len = states('var.reminder').split("|") | length %}
              {% set ran_idx = range(0, len) | random() %}
              {{ states('var.reminder').split("|")[ran_idx] }}

              {%- if is_state_attr('sensor.affald_hentes', 'days', '1') %}
                {{ states('var.trash') }}
              {% else %}
                {{ states('var.recycle') }}
              {% endif -%}